<!DOCTYPE html>
<html lang="en">

<head>
    <title>Win10 下 Perforce 命令行快速上手 | Celestial</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://paakmau.github.io/style.css">
    <link rel="stylesheet" href="https://paakmau.github.io/color/orange-auto.css">

        <link rel="stylesheet" href="https://paakmau.github.io/color/background_auto.css">
    
    <link rel="stylesheet" href="https://paakmau.github.io/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="Win10 下 Perforce 命令行快速上手 | Celestial">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://paakmau.github.io/202007112038/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="Win10 下 Perforce 命令行快速上手 | Celestial">
    <meta property="twitter:domain" content="paakmau.github.io">
    <meta property="twitter:url" content="https://paakmau.github.io/202007112038/">

                <link rel="alternate" type="application/rss+xml" title="Celestial RSS Feed" href="https://paakmau.github.io/rss.xml" />
                <link rel="alternate" type="application/atom+xml" title="Celestial Atom Feed" href="https://paakmau.github.io/atom.xml" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral'
        });
    </script>
</head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://paakmau.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            Celestial
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://paakmau.github.io">home</a></li>
            
                <li><a href="https://paakmau.github.io/tags">tags</a></li>
            
                <li><a href="https://github.com/paakmau" target="_blank" rel="noopener noreferrer">github</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://paakmau.github.io/202007112038/">Win10 下 Perforce 命令行快速上手</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2020-07-11
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://paakmau.github.io/tags/perforce/">#Perforce</a></span>
    

        <div class="post-content">
            <p>相对于 Git 和 SVN，Perforce 在管理二进制文件上更方便</p>
<span id="continue-reading"></span>
<p>本文参考了官网教程</p>
<p><a href="https://www.perforce.com/manuals/p4guide/Content/P4Guide/tutorial.readmefirst.html">https://www.perforce.com/manuals/p4guide/Content/P4Guide/tutorial.readmefirst.html</a></p>
<h2 id="git-yong-hu-kan-zhe-li">Git 用户看这里</h2>
<p>Stream Depot 大概可以理解为一个 Git 项目，然后 Stream 就是 Git 里的分支</p>
<p>其中 Stream 必须要依赖于 Stream Depot 存在</p>
<h2 id="an-zhuang">安装</h2>
<p><a href="https://www.perforce.com/downloads">https://www.perforce.com/downloads</a></p>
<p>把服务端和命令行客户端都装上就行了，也可以整图形化界面</p>
<p>Windows 下安装包会自动配置环境变量；并且服务端装完后会自动启动，如果没有的话就用 <code>p4d</code> 命令启动服务端</p>
<p>我们可以在 PowerShell 里输入下面的命令测试一下服务端是否正常</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 info
</span></code></pre>
<h2 id="chuang-jian-stream-depot">创建 Stream Depot</h2>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 depot -t stream TestDepot
</span></code></pre>
<p>解释一下，这行命令创建了一个名为 <code>TestDepot</code> 的 Stream Depot，<code>-t stream</code> 用于指定这个 Depot 的类型</p>
<h2 id="chuang-jian-stream">创建 Stream</h2>
<p>Git 中我们通常会开 <code>master</code> 和 <code>dev</code> 分支</p>
<p>在 Perforce 里我们也可以做同样的操作，使用下面两行命令创建 <code>main</code> 和 <code>dev</code> 两个 Stream</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 stream -t mainline //TestDepot/main
</span><span>p4 stream -t development -P //TestDepot/main //TestDepot/dev
</span></code></pre>
<p>解释一下，<code>-t</code> 参数用于指定 Stream 的类型，<code>-P</code> 参数用于指定父 Stream；上面的例子里 <code>main</code> 这个 Stream 是 <code>dev</code> 的父 Stream</p>
<p>需要注意 <code>mainline</code> 类型的 Stream 不能有父 Stream</p>
<p>我们可以使用下面的命令来查看所有的 Stream</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 streams
</span></code></pre>
<h2 id="chuang-jian-workspace">创建 Workspace</h2>
<p>之前 Stream 相关的操作都是作用在服务端上的</p>
<p>这里我们在本地创建 Workspace</p>
<p>首先设置环境变量 <code>P4CLIENT</code>，这个是 PowerShell 的写法<br>
配环境变量这种操作其实我是觉得挺离谱的</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span style="color:#ffb964;">$env:P4CLIENT</span><span>=</span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">hello_client</span><span style="color:#556633;">&#39;
</span></code></pre>
<p>然后 <code>cd</code> 到一个空的文件夹，输入以下命令</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 client -S //TestDepot/main
</span></code></pre>
<p>这样这个文件夹就跟 <code>main</code> 这个 Stream 绑定起来了</p>
<h2 id="tian-jia-wen-jian">添加文件</h2>
<p>在这个文件夹里新建一个文件 <code>test_file.txt</code></p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 add .\test_file.txt
</span><span>p4 submit -d </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">Add a test file</span><span style="color:#556633;">&#39;
</span></code></pre>
<h2 id="xiu-gai-wen-jian">修改文件</h2>
<p>Workspace 里已有的文件通常都是只读的，我们使用下面这行命令修改 <code>test_file.txt</code> 的读写权限</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 edit .\test_file.txt
</span></code></pre>
<p>然后用编辑器改一下里面的内容</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 submit -d </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">Modify a test file</span><span style="color:#556633;">&#39;
</span></code></pre>
<h2 id="shan-chu-wen-jian">删除文件</h2>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 delete .\test_file.txt
</span><span>p4 submit -d </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">Delete a test file</span><span style="color:#556633;">&#39;
</span></code></pre>
<p>需要注意这个只是从服务端把该文件删除，Workspace 里这个文件依然存在</p>
<h2 id="yu-fu-wu-duan-tong-bu">与服务端同步</h2>
<p>如果其他人对 Stream 进行了修改并提交到了服务端，我们可以把这些修改同步到本地的 Workspace 里</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 sync
</span></code></pre>
<h2 id="qie-huan-stream">切换 Stream</h2>
<p>我们可以使用下面这个命令查看所有的 Stream</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 </span><span style="color:#8fbfdc;">switch </span><span>-l
</span></code></pre>
<p>然后我们切换到 <code>dev</code></p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 </span><span style="color:#8fbfdc;">switch </span><span>-r dev
</span></code></pre>
<h2 id="he-bing-stream">合并 Stream</h2>
<p><code>merge</code> 命令只能以父 Stream 为源，子 Stream 为目标</p>
<p>首先 <code>switch</code> 到子 Stream，然后执行下面的命令，会自动从父 Stream 上合并过来</p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 merge
</span><span>p4 resolve
</span></code></pre>
<p>后面的 <code>resolve</code> 命令是解决两个 Stream 的冲突，不同于 Git 的自动合并，手动合并非常原始，建议使用图形化界面或者编辑器插件</p>
<p><code>resolve</code> 完了之后记得 <code>submit</code></p>
<pre data-lang="ps1" style="background-color:#151515;color:#e8e8d3;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>p4 submit -d </span><span style="color:#556633;">&quot;</span><span style="color:#99ad6a;">Merge</span><span style="color:#556633;">&quot;
</span></code></pre>

        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Thanks for reading! Read other posts?</span>
                    <hr />
                </div>
                <div class="pagination__buttons">
                        <span class="button previous">
                            <a href="https://paakmau.github.io/202007071821/">
                                <span class="button__icon">←</span>&nbsp;
                                <span class="button__text">使用 Vue.js 和 Spring Boot 配置 WebSocket</span>
                            </a>
                        </span>
                    
                    
                        <span class="button next">
                            <a href="https://paakmau.github.io/202007141756/">
                                <span class="button__text">并发环境下实现懒加载</span>&nbsp;
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    </div>
            </div>
        
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2025
 Powered by <a href="https://www.getzola.org/">Zola</a></span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
