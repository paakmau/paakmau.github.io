<!DOCTYPE html>
<html lang="en">

<head>
    <title>为 openGauss 导入 TPC-H 数据集 | Celestial</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://paakmau.github.io/style.css">
    <link rel="stylesheet" href="https://paakmau.github.io/color/orange-auto.css">

        <link rel="stylesheet" href="https://paakmau.github.io/color/background_auto.css">
    
    <link rel="stylesheet" href="https://paakmau.github.io/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="为 openGauss 导入 TPC-H 数据集 | Celestial">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://paakmau.github.io/202502062219/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="为 openGauss 导入 TPC-H 数据集 | Celestial">
    <meta property="twitter:domain" content="paakmau.github.io">
    <meta property="twitter:url" content="https://paakmau.github.io/202502062219/">

                <link rel="alternate" type="application/rss+xml" title="Celestial RSS Feed" href="https://paakmau.github.io/rss.xml" />
                <link rel="alternate" type="application/atom+xml" title="Celestial Atom Feed" href="https://paakmau.github.io/atom.xml" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral'
        });
    </script>
</head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://paakmau.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            Celestial
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://paakmau.github.io">home</a></li>
            
                <li><a href="https://paakmau.github.io/tags">tags</a></li>
            
                <li><a href="https://github.com/paakmau" target="_blank" rel="noopener noreferrer">github</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://paakmau.github.io/202502062219/">为 openGauss 导入 TPC-H 数据集</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2025-02-06
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://paakmau.github.io/tags/opengauss/">#openGauss</a>&nbsp;
                <a class="post-tag" href="https://paakmau.github.io/tags/ji-zhun-ce-shi/">#基准测试</a>&nbsp;
                <a class="post-tag" href="https://paakmau.github.io/tags/shu-ju-ku/">#数据库</a></span>
    

        <div class="post-content">
            <p>TPC-H 是一个决策支持基准测试。
它由一套面向业务的即席查询与并发数据修改组成。
其数据集与查询具有广泛的行业相关性。
这个基准测试模拟了一个决策支持系统，该系统会对大规模的数据执行高复杂度的查询以回答关键商务问题。</p>
<p>本文会记录将 TPC-H 数据集导入 openGauss 的过程。</p>
<span id="continue-reading"></span><h2 id="gou-jian-tpc-h-shu-ju-sheng-cheng-gong-ju">构建 TPC-H 数据生成工具</h2>
<p>官网链接为 <a href="https://www.tpc.org/tpc_documents_current_versions/current_specifications5.asp">https://www.tpc.org/tpc_documents_current_versions/current_specifications5.asp</a>。
在其中点击形如 <code>Download TPC-H_Tools_v3.0.1.zip</code> 的超链接，然后填写邮箱等信息，就可以收到包含下载地址的邮件。</p>
<p>下载好之后解压：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#ffb964;">unzip</span><span> D12D3B85-DBE4-45B4-96D2-7DAAF4292C10-TPC-H-Tool.zip
</span></code></pre>
<p>会解压出一个 <code>TPC-H V3.0.1</code> 目录，把目录内的 <code>dbgen/makefile.suite</code> 文件拷贝为 <code>Makefile</code>：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span>cd </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">TPC-H V3.0.1/dbgen</span><span style="color:#556633;">&#39;
</span><span style="color:#ffb964;">cp</span><span> makefile.suite Makefile
</span></code></pre>
<p>于是修改这个 <code>Makefile</code>，对一些变量进行赋值：</p>
<pre data-lang="mk" style="background-color:#151515;color:#e8e8d3;" class="language-mk "><code class="language-mk" data-lang="mk"><span>CC        = gcc
</span><span>DATABASE  = ORACLE
</span><span>MACHINE   = LINUX
</span><span>WORKLOAD  = TPCH
</span></code></pre>
<p>直接构建：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#ffb964;">make
</span></code></pre>
<p>构建完成后会得到 <code>dbgen</code> 与 <code>qgen</code>，分别用于生成数据集与查询语句。</p>
<h2 id="sheng-cheng-shu-ju-ji">生成数据集</h2>
<p>使用 <code>dbgen</code> 生成数据：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#ffb964;">./dbgen -s</span><span> 1
</span></code></pre>
<p>其中 <code>-s</code> 参数用于指定缩放系数，会影响生成数据的规模。
这个缩放系数与生成出数据的 GB 数大致相等，比如 <code>-s 10</code> 大约会生成 10GB 的数据。
生成完成后，我们会得到八个 <code>.tbl</code> 文件：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#ffb964;">$</span><span> ls *.tbl
</span><span style="color:#ffb964;">customer.tbl</span><span>  lineitem.tbl  nation.tbl  orders.tbl  partsupp.tbl  part.tbl  region.tbl  supplier.tbl
</span></code></pre>
<h2 id="chuang-jian-biao">创建表</h2>
<p>先建一个库：</p>
<pre data-lang="sql" style="background-color:#151515;color:#e8e8d3;" class="language-sql "><code class="language-sql" data-lang="sql"><span>CREATE DATABASE </span><span style="color:#fad07a;">tpch</span><span>;
</span></code></pre>
<p>然后在 <code>dbgen</code> 目录里面有一个 <code>dss.ddl</code> 文件，里面是创建表的语句，可以直接丢给 openGauss 执行：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#ffb964;">gsql -d</span><span> tpch</span><span style="color:#ffb964;"> -f</span><span> dss.ddl
</span></code></pre>
<p>于是就可以在 <code>tpch</code> 这个库里面创建出八张表。</p>
<h2 id="dao-ru-shu-ju">导入数据</h2>
<p>这些 <code>.tbl</code> 文件中，每行数据都会以 <code>|</code> 结尾，无法被 openGauss 导入。
因此需要把行末的 <code>|</code> 去掉，顺带把后缀名改为 <code>.csv</code>：</p>
<pre data-lang="sh" style="background-color:#151515;color:#e8e8d3;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#8fbfdc;">for</span><span> file </span><span style="color:#8fbfdc;">in </span><span>*.tbl; </span><span style="color:#8fbfdc;">do
</span><span>  </span><span style="color:#ffb964;">sed </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">s/|$//</span><span style="color:#556633;">&#39; </span><span>$</span><span style="color:#ffb964;">file </span><span>&gt; ${</span><span style="color:#ffb964;">file</span><span>/tbl/csv}
</span><span style="color:#8fbfdc;">done
</span></code></pre>
<p>于是用 <code>\copy</code> 元命令导入就可以了：</p>
<pre data-lang="sql" style="background-color:#151515;color:#e8e8d3;" class="language-sql "><code class="language-sql" data-lang="sql"><span>\copy customer FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">customer.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy lineitem FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">lineitem.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy nation FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">nation.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy orders FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">orders.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy partsupp FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">partsupp.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy part FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">part.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy region FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">region.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span><span>\copy supplier FROM </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">supplier.csv</span><span style="color:#556633;">&#39; </span><span>WITH csv DELIMITER </span><span style="color:#556633;">&#39;</span><span style="color:#99ad6a;">|</span><span style="color:#556633;">&#39;
</span></code></pre>

        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Thanks for reading! Read other posts?</span>
                    <hr />
                </div>
                <div class="pagination__buttons">
                        <span class="button previous">
                            <a href="https://paakmau.github.io/202501251102/">
                                <span class="button__icon">←</span>&nbsp;
                                <span class="button__text">为 openGauss 配置大页内存</span>
                            </a>
                        </span>
                    
                    
                        <span class="button next">
                            <a href="https://paakmau.github.io/202502192154/">
                                <span class="button__text">NUMA 相关命令速查笔记</span>&nbsp;
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    </div>
            </div>
        
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2025
 Powered by <a href="https://www.getzola.org/">Zola</a></span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
